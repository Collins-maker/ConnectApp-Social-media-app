const config = require('../config/config');
const mssql = require('mssql');
const bcrypt = require('bcrypt');

module.exports ={
    loginUser: async(req,res)=>{
        let {username, password} = req.body;

        try {
            let sql =await mssql.connect(config);
            if (sql.connected) {
                let results = await sql.request()
                                        .input('username', username)
                                        .execute('getUserByUsername');
                let user= results.recordset[0];
                if (user) {
                    let passwords_match = await bcrypt.compare(password, user.password);
                    passwords_match ? res.json({ sucess:true, message: "logged in successfully"}) :
                                    res.status(404).json({success: false, message: "Wrong password"})
                }
            } else{
                res.status(500).json({success:false, message:"intenal server error!"})
            }
        } catch (error) {
            
        }
    }
}